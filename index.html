<!DOCTYPE html>
<html>
<head>
    <title>Simple Traffic Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: gray;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: greenyellow ;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .road {
            width: 100%;
            height: 150px;
            background: #333;
            position: relative;
            margin: 20px 0;
            border-top: 5px dashed #ccc;
            border-bottom: 5px dashed #ccc;
        }
        .car {
            width: 20px;
            height: 10px;
            background: #4CAF50;
            position: absolute;
            border-radius: 3px;
        }
        .controls {
            margin: 20px;
        }
        .slider-container {
            margin: 10px;
        }
        .math {
            background: cyan;
            padding: 10px;
            border-radius: 5px;
            margin: 10px;
            font-size: 18px;
        }
        .info {
            display: flex;
            justify-content: space-around;
            margin: 20px;
        }
        .info-box {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simple Traffic Control System</h1>
        <p>Using the formula: v(ρ) = C × ln(P_max / ρ)</p>
        
        <div class="math">
            v(ρ) = <span id="Cvalue">30</span> × ln(<span id="Pvalue">0.25</span> / <span id="ρvalue">0.1</span>)
            = <span id="result">34.5</span> m/s
        </div>
        
        <div class="road" id="road"></div>
        
        <div class="info">
            <div class="info-box">
                <strong>Optimal Speed:</strong><br>
                <span id="speed">34.5</span> m/s
            </div>
            <div class="info-box">
                <strong>Traffic Flow:</strong><br>
                <span id="flow">3.45</span> cars/s
            </div>
            <div class="info-box">
                <strong>Spacing:</strong><br>
                <span id="spacing">10.0</span> m
            </div>
        </div>
        
        <div class="controls">
            <div class="slider-container">
                <label>Density (ρ): <span id="densityValue">0.1</span> cars/m</label><br>
                <input type="range" id="density" min="0.01" max="0.24" step="0.01" value="0.1">
            </div>
            
            <div class="slider-container">
                <label>C (Max Speed): <span id="Cslider">30</span></label><br>
                <input type="range" id="C" min="10" max="50" step="1" value="30">
            </div>
            
            <div class="slider-container">
                <label>P_max (Max Density): <span id="Pslider">0.25</span></label><br>
                <input type="range" id="Pmax" min="0.1" max="0.5" step="0.01" value="0.25">
            </div>
        </div>
        
        <div>
            <button onclick="addCar()">Add Car</button>
            <button onclick="removeCar()">Remove Car</button>
            <button onclick="startSimulation()">Start</button>
            <button onclick="stopSimulation()">Stop</button>
        </div>
    </div>

    <script>
        // Initialize variables
        let cars = [];
        let density = 0.1;
        let C = 30;
        let P_max = 0.25;
        let simulationRunning = false;
        let simulationId;
        const road = document.getElementById('road');
        const roadWidth = 800; // Road width in pixels
        
        // Create initial cars
        function createCars() {
            road.innerHTML = '';
            cars = [];
            const spacing = roadWidth / (density * 100); // Convert to pixels
            
            for (let i = 0; i < density * 100; i++) {
                const car = document.createElement('div');
                car.className = 'car';
                car.style.left = (i * spacing) + 'px';
                car.style.top = '70px';
                road.appendChild(car);
                cars.push({
                    element: car,
                    x: i * spacing,
                    speed: calculateOptimalSpeed()
                });
            }
        }
        
        // Calculate optimal speed using the formula
        function calculateOptimalSpeed() {
            if (density >= P_max) return 0;
            if (density <= 0) return C;
            
            // v(ρ) = C × ln(P_max / ρ)
            const speed = C * Math.log(P_max / density);
            return Math.max(0, Math.min(C, speed)); // Keep between 0 and C
        }
        
        // Update the math display
        function updateMathDisplay() {
            const speed = calculateOptimalSpeed();
            const flow = density * speed;
            
            document.getElementById('Cvalue').textContent = C;
            document.getElementById('Pvalue').textContent = P_max.toFixed(2);
            document.getElementById('ρvalue').textContent = density.toFixed(2);
            document.getElementById('result').textContent = speed.toFixed(1);
            document.getElementById('speed').textContent = speed.toFixed(1);
            document.getElementById('flow').textContent = flow.toFixed(2);
            document.getElementById('spacing').textContent = (1/density).toFixed(1);
        }
        
        // Update car positions
        function updateCars() {
            const optimalSpeed = calculateOptimalSpeed();
            
            cars.forEach((car, index) => {
                // Move car based on optimal speed
                car.x += optimalSpeed * 0.1; // Scale for animation
                
                // Wrap around when car reaches end of road
                if (car.x > roadWidth) {
                    car.x = 0;
                }
                
                car.element.style.left = car.x + 'px';
                
                // Change color based on speed
                if (optimalSpeed > C * 0.7) car.element.style.background = '#4CAF50';
                else if (optimalSpeed > C * 0.4) car.element.style.background = '#FFC107';
                else car.element.style.background = '#F44336';
            });
        }
        
        // Simulation loop
        function simulationLoop() {
            updateCars();
            if (simulationRunning) {
                simulationId = requestAnimationFrame(simulationLoop);
            }
        }
        
        // Control functions
        function addCar() {
            density = Math.min(P_max - 0.01, density + 0.02);
            updateDensity();
        }
        
        function removeCar() {
            density = Math.max(0.02, density - 0.02);
            updateDensity();
        }
        
        function startSimulation() {
            if (!simulationRunning) {
                simulationRunning = true;
                simulationLoop();
            }
        }
        
        function stopSimulation() {
            simulationRunning = false;
            cancelAnimationFrame(simulationId);
        }
        
        function updateDensity() {
            document.getElementById('densityValue').textContent = density.toFixed(2);
            createCars();
            updateMathDisplay();
        }
        
        // Event listeners for sliders
        document.getElementById('density').addEventListener('input', function(e) {
            density = parseFloat(e.target.value);
            updateDensity();
        });
        
        document.getElementById('C').addEventListener('input', function(e) {
            C = parseInt(e.target.value);
            document.getElementById('Cslider').textContent = C;
            updateMathDisplay();
        });
        
        document.getElementById('Pmax').addEventListener('input', function(e) {
            P_max = parseFloat(e.target.value);
            document.getElementById('Pslider').textContent = P_max.toFixed(2);
            
            // Ensure density doesn't exceed new P_max
            if (density >= P_max) {
                density = P_max - 0.01;
                document.getElementById('density').value = density;
                document.getElementById('densityValue').textContent = density.toFixed(2);
            }
            
            createCars();
            updateMathDisplay();
        });
        
        // Initialize
        createCars();
        updateMathDisplay();
    </script>
</body>
</html>
